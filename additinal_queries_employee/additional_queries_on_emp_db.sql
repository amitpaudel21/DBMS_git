CREATE DATABASE EMPLOYEE;
USE EMPLOYEE ;
CREATE TABLE DEPT (DEPTNO INT PRIMARY KEY, DNAME VARCHAR(50), DLOC VARCHAR(50));
CREATE TABLE PROJECT (PNO INT PRIMARY KEY, PNAME VARCHAR(50), PLOC VARCHAR(50));
CREATE TABLE EMPLOYEE (EMPNO INT PRIMARY KEY, ENAME VARCHAR(50), MGR_NO INT, HIREDATE DATE, SAL DECIMAL (10,2), DEPTNO INT, FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO));
CREATE TABLE ASSIGNED_TO (EMPNO INT, PNO INT, JOB_ROLE VARCHAR(50), PRIMARY KEY (EMPNO, PNO), FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE (EMPNO), FOREIGN KEY (PNO) REFERENCES PROJECT(PNO));
CREATE TABLE INCENTIVES(EMPNO INT, INCENTIVE_DATE DATE, INCENTIVE_AMOUNT DECIMAL(10,2),PRIMARY KEY(INCENTIVE_DATE), FOREIGN KEY(EMPNO) REFERENCES EMPLOYEE (EMPNO));

INSERT INTO DEPT VALUES (1,'Engineering','Bengaluru'),(2,'HR','Hyderabad'),(3,'Finance','Mysuru'),(4,'Marketing','Bengaluru'),(5,'Operations','Hyderabad'),(6,'IT','Mysuru');
INSERT INTO EMPLOYEE VALUES (101,'Ravi',100,'2020-03-10',55000,1),(102,'Anita',100,'2021-06-22',62000,2),(103,'Suresh',105,'2019-12-11',58000,3),(104,'Kiran',105,'2018-05-15',60000,4),(105,'Divya',NULL,'2015-01-01',90000,1),(106,'Manoj',102,'2017-07-18',75000,3);
INSERT INTO PROJECT VALUES (201,'AI Development','Bengaluru'),(202,'HR Portal','Hyderabad'),(203,'Budget Analysis','Mysuru'),(204,'Marketing Campaign','Bengaluru'),(205,'Supply Chain','Mysuru'),(206,'Cybersecurity','Hyderabad');
INSERT INTO INCENTIVES VALUES (101,'2023-06-01',5000.00),(102,'2023-09-10',3000.00),(103,'2023-08-20',4000.00),(104,'2019-01-10',2500.00),(105,'2023-10-05',4500.00),(106,'2023-11-12',3500.00);
INSERT INTO ASSIGNED_TO VALUES (101,201,'Lead Developer'),(102,201,'Developer'),(103,202,'HR Analyst'),(104,202,'Coordinator'),(105,203,'Analyst'),(106,203,'Assistant');


SELECT E.ENAME AS Manager_Name
FROM EMPLOYEE E
JOIN (
    SELECT MGR_NO, COUNT(*) AS Num_Employees
    FROM EMPLOYEE
    WHERE MGR_NO IS NOT NULL
    GROUP BY MGR_NO
    HAVING COUNT(*) = (
        SELECT MAX(Num_Employees)
        FROM (
            SELECT MGR_NO, COUNT(*) AS Num_Employees
            FROM EMPLOYEE
            WHERE MGR_NO IS NOT NULL
            GROUP BY MGR_NO
        ) AS Sub
    )
) AS MaxMgr ON E.EMPNO = MaxMgr.MGR_NO;


SELECT DISTINCT E.ENAME AS Manager_Name
FROM EMPLOYEE E
JOIN EMPLOYEE Emp ON Emp.MGR_NO = E.EMPNO
GROUP BY E.EMPNO, E.ENAME, E.SAL
HAVING E.SAL > AVG(Emp.SAL);


SELECT E.ENAME FROM EMPLOYEE E
WHERE E.MGR_NO IN (SELECT E1.EMPNO FROM EMPLOYEE E1, DEPT D WHERE E1.DEPTNO=D.DEPTNO AND E1.MGR_NO IS NULL);


SELECT *
FROM INCENTIVES I
JOIN EMPLOYEE E ON I.EMPNO = E.EMPNO
WHERE I.INCENTIVE_DATE BETWEEN '2019-01-01' AND '2019-01-31'
AND I.INCENTIVE_AMOUNT = (
    SELECT MAX(INCENTIVE_AMOUNT)
    FROM INCENTIVES
    WHERE INCENTIVE_DATE BETWEEN '2019-01-01' AND '2019-01-31'
    AND INCENTIVE_AMOUNT < (
        SELECT MAX(INCENTIVE_AMOUNT)
        FROM INCENTIVES
        WHERE INCENTIVE_DATE BETWEEN '2019-01-01' AND '2019-01-31'
    )
);


SELECT E.EMPNO, E.ENAME, E.DEPTNO AS Employee_Dept, Mgr.DEPTNO AS Manager_Dept
FROM EMPLOYEE E
JOIN EMPLOYEE Mgr ON E.MGR_NO = Mgr.EMPNO
JOIN DEPT D ON E.DEPTNO=D.DEPTNO
WHERE E.DEPTNO = Mgr.DEPTNO;